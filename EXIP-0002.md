# EXIP-0002 : More Highly Reactive Difficulty Scaling Algorithm

```
Number:  EXIP-0002
Title:   More Highly Reactive Difficulty Scaling Algorithm
Type:    Standard
Status:  Draft
Authors: ElixiumNetwork <team@elixium.app>
Created: 2018-11-06
```

## Abstract

The current difficulty scaling algorithm in Elixium is vulnerable to miner-manipulated difficulty oscillation. EXIP-0002 suggests changes to the difficulty scaling algorithm to make the network more resilient against this type of manipulation.

## Motivation

We're currently using the same [difficulty scaling algorithm that Bitcoin uses](https://en.bitcoin.it/wiki/Difficulty). This algorithm works well for Bitcoin because of its network's massive amount of hashing power -- making it difficult for miners to manipulate. In the case of Elixium, we're going to have to move away from this algorithm because it will be easily manipulated as miners can join / leave and (early on) cause large oscillations in mining difficulty.

Oscillations in mining difficulty are a huge problem, they could cause Elixium to have massive block delays -- instead of a block getting propagated every 2 minutes, it could grow to a new block every 3 days, in the following (pretty likely) scenario:

1. Difficulty is set to 10 and the network is happily chugging along.
2. Mining pool / group of miners with massive hashing power start mining Elixium (lets say, collectively, they have 10x the hashing power of the rest of the network).
3. They quickly reach a new epoch and the difficulty scales proportionately to the new hashrate (becomes lets say a difficulty of 20).
4. Now that mining has become more difficult, miners leave and go mine a different coin.
5. We're now early in an epoch where the mining difficulty is 10x what the network hashrate can handle in order to produce a block every 2 minutes, so blocks are now produced every 20 minutes instead of every 2 minutes, and the entire network moves very slowly until the next epoch, where the difficulty will scale back down.
6. Miners see that the difficulty scaled back down, so they start mining Elixium again, and now we oscillate back up to a high difficulty and repeat the cycle.

We want to find a difficulty scaling algorithm that quickly scales and rebounds from these oscillations and implement it into Elixium.

## Body

We're currently operating using a Simple Moving Average (SMA) difficulty algorithm, where every 10,080 blocks (roughly 2 weeks) we find the average time it took to solve each block and compare it to our target solvetime. We then scale the difficulty based on the difference in actual average solvetime vs target solvetime. When T is target solvetime, A is average solvetime, and D is current difficulty, our difficulty algorithm is:

```
D' = D + log(T / A) / log(16)
```


## References

1. [LWMA (Linearly Weighted Moving Average)](https://github.com/zawy12/difficulty-algorithms/issues/3)
2. [EMA](https://github.com/zawy12/difficulty-algorithms/issues/21)
3. [Revisiting Difficulty Control for Blockchain
Systems](https://eprint.iacr.org/2017/731.pdf)
